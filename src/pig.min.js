!function(t){"use strict";function e(t,e,i,s){var n="#"+t+" {  position: relative;}."+e+"-figure {  background-color: #D5D5D5;  overflow: hidden;  left: 0;  position: absolute;  top: 0;  margin: 0;}."+e+"-figure-title {  background-color: white;  width: 100%;}."+e+"-figure h1 {  font-size: 21px;  margin: 0 15px;  line-height: "+s+'px;  color: #4CAF50;  text-transform: uppercase;  font-family: keepcalm, "Helvetica Neue", Helvetica, Arial, sans-serif;  background-color: transparent;}.'+e+"-figure img {  left: 0;  position: absolute;  top: 0;  height: 100%;  width: 100%;  opacity: 0;  transition: "+i/1e3+"s ease opacity;  -webkit-transition: "+i/1e3+"s ease opacity;}."+e+"-figure img."+e+"-thumbnail {  -webkit-filter: blur(30px);  filter: blur(30px);  left: auto;  position: relative;  width: auto;}."+e+"-figure img."+e+"-loaded {  opacity: 1;}",a=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",o.styleSheet?o.styleSheet.cssText=n:o.appendChild(document.createTextNode(n)),a.appendChild(o)}function i(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}function s(t,s){return this.inRAF=!1,this.isTransitioning=!1,this.minAspectRatioRequiresTransition=!1,this.minAspectRatio=null,this.latestYOffset=0,this.lastScrollElementWidth=window.innerWidth,this.scrollDirection="down",this.visibleImages=[],this.settings={containerId:"pig",classPrefix:"pig",figureTagName:"figure",groupTitleHeight:100,spaceBetweenImages:8,transitionSpeed:500,primaryImageBufferHeight:1e3,secondaryImageBufferHeight:300,thumbnailSize:20,urlForSize:function(t,e){return"/img/"+e+"/"+t},getMinAspectRatio:function(t){return t<=640?2:t<=1280?4:t<=1920?5:6},getImageSize:function(t){return t<=640?100:t<=1920?250:500}},i(this.settings,s||{}),this.elements=this._parseImageData(t),e(this.settings.containerId,this.settings.classPrefix,this.settings.transitionSpeed,this.settings.groupTitleHeight),this}function n(t,e,i){return this.type="title",this.existsOnPage=!1,this.sessionId=t.sessionId,this.submissionId=t.submissionId,this.index=e,this.pig=i,this.classNames={figure:i.settings.classPrefix+"-figure "+i.settings.classPrefix+"-figure-title"},this}function a(t,e,i){return this.type="image",this.existsOnPage=!1,this.aspectRatio=t.aspectRatio,this.filename=t.filename,this.sessionId=t.sessionId,this.submissionId=t.submissionId,this.index=e,this.pig=i,this.classNames={figure:i.settings.classPrefix+"-figure",thumbnail:i.settings.classPrefix+"-thumbnail",loaded:i.settings.classPrefix+"-loaded"},this}var o=function(){function t(){s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,66))}function e(){i.forEach(function(t){t()}),s=!1}var i=[],s=!1;return{add:function(e){i.length||window.addEventListener("resize",t),i.push(e)},disable:function(){window.removeEventListener("resize",t)},reEnable:function(){window.addEventListener("resize",t)}}}();s.prototype._getTransitionTimeout=function(){var t=1.5;return this.settings.transitionSpeed*t},s.prototype._getTransitionString=function(){return this.isTransitioning?this.settings.transitionSpeed/1e3+"s transform ease":"none"},s.prototype._recomputeMinAspectRatio=function(){var t=this.minAspectRatio;this.minAspectRatio=this.settings.getMinAspectRatio(this.lastScrollElementWidth),null!==t&&t!==this.minAspectRatio?this.minAspectRatioRequiresTransition=!0:this.minAspectRatioRequiresTransition=!1},s.prototype._parseImageData=function(t){var e=[],i=0;return t.forEach(function(s,o){function h(t){var s={sessionId:t.sessionId,submissionId:t.submissionId},a=new n(s,i,this);i++,e.push(a)}0===o&&h.call(this,s);var l=new a(s,o,this);e.push(l),t[o+1]&&s[this.settings.groupKey]!==t[o+1][this.settings.groupKey]&&h.call(this,t[o+1])}.bind(this)),e},s.prototype._computeLayout=function(){var t=parseInt(this.container.clientWidth),e=[],i=this.settings.spaceBetweenImages,s=0,o=0,h=null,l=null;this._recomputeMinAspectRatio(),!this.isTransitioning&&this.minAspectRatioRequiresTransition&&(this.isTransitioning=!0,setTimeout(function(){this.isTransitioning=!1},this._getTransitionTimeout()));var r=this._getTransitionString();[].forEach.call(this.elements,function(g,c){if(e.push(g),g instanceof n)i=0,e.forEach(function(t){t.style={height:this.settings.groupTitleHeight,translateX:i,translateY:s,transition:r}}.bind(this)),e=[],o=0,i=this.settings.spaceBetweenImages,s+=this.settings.groupTitleHeight+this.settings.spaceBetweenImages;else if(g instanceof a&&(o+=parseFloat(g.aspectRatio),o>=this.minAspectRatio||c+1===this.elements.length||this.elements[c+1]&&this.elements[c+1]instanceof n)){o>=this.minAspectRatio&&(o=Math.max(o,this.minAspectRatio),h=e.length,l=o),h&&l||(o=this.minAspectRatio,h=e.length,l=o);var u=t-this.settings.spaceBetweenImages*(h+1),m=u/l;e.forEach(function(t){var e=m*t.aspectRatio;t.style={width:parseInt(e),height:parseInt(m),translateX:i,translateY:s,transition:r},i+=e+this.settings.spaceBetweenImages}.bind(this)),e=[],o=0,s+=parseInt(m)+this.settings.spaceBetweenImages,i=this.settings.spaceBetweenImages}}.bind(this)),this.totalHeight=s-this.settings.spaceBetweenImages},s.prototype._setTotalHeight=function(){var t=document.getElementById("photos").clientWidth,e=[],i=0,s=0;this._recomputeMinAspectRatio(),[].forEach.call(this.elements,function(o,h){if(e.push(o),o instanceof n)e=[],s=0,i+=this.settings.groupTitleHeight+this.settings.spaceBetweenImages;else if(o instanceof a&&(s+=parseFloat(o.aspectRatio),s>=this.minAspectRatio||h+1===this.elements.length||this.elements[h+1]&&this.elements[h+1]instanceof n)){s=Math.max(s,this.minAspectRatio);var l=t-this.settings.spaceBetweenImages*(e.length-1),r=l/s;e=[],s=0,i+=parseInt(r)+this.settings.spaceBetweenImages}}.bind(this)),this.totalHeight=i-this.settings.spaceBetweenImages},s.prototype._doLayout=function(){this.container.style.height=this.totalHeight+"px";var t="up"===this.scrollDirection?this.settings.primaryImageBufferHeight:this.settings.secondaryImageBufferHeight,e="down"===this.scrollDirection?this.settings.primaryImageBufferHeight:this.settings.secondaryImageBufferHeight,i=this.scrollElement.offsetHeight,s=this.latestYOffset-t,n=this.latestYOffset+i+e;this.elements.forEach(function(t){t.style.translateY<=this.latestYOffset&&t.style.translateY+t.style.height>=this.latestYOffset&&(window.name=t[this.settings.groupKey]),t.style.translateY+t.style.height<s||t.style.translateY>n?t.hide():t.load()}.bind(this))},s.prototype._getOnScroll=function(){var t=this,e=function(){var e=t.scrollElement.scrollTop;t.previousYOffset=t.latestYOffset||e,t.latestYOffset=e,t.scrollDirection=t.latestYOffset>t.previousYOffset?"down":"up",t.inRAF||(t.inRAF=!0,window.requestAnimationFrame(function(){t._doLayout(),t.inRAF=!1}))};return e},s.prototype.enable=function(){return this.container=document.getElementById(this.settings.containerId),this.scrollElement=this.container.parentElement,this.container?(this.onScroll=this._getOnScroll(),this.scrollElement.addEventListener("scroll",this.onScroll),this.onScroll(),this._computeLayout(),this._doLayout(),o.add(function(){this.lastScrollElementWidth=this.scrollElement.offsetWidth,this._computeLayout(),this._doLayout()}.bind(this)),this):void console.error("Could not find element with ID "+this.settings.containerId)},s.prototype.disable=function(){return this.scrollElement.removeEventListener("scroll",this.onScroll),o.disable(),this},n.prototype.load=function(){this.existsOnPage=!0,this._updateStyles(),this.pig.container.appendChild(this.getElement()),setTimeout(function(){if(this.existsOnPage&&!this.title){var t=document.createTextNode(this[this.pig.settings.groupKey]);this.title=document.createElement("H1"),this.title.appendChild(t),this.getElement().appendChild(this.title)}}.bind(this),100)},n.prototype.hide=function(){this.getElement()&&this.title&&(this.getElement().removeChild(this.title),delete this.title),this.existsOnPage&&this.pig.container.removeChild(this.getElement()),this.existsOnPage=!1},n.prototype.getElement=function(){return this.element||(this.element=document.createElement(this.pig.settings.figureTagName),this.element.className=this.classNames.figure,this._updateStyles()),this.element},n.prototype._updateStyles=function(){this.getElement().style.transition=this.style.transition,this.getElement().style.height=this.style.height+"px",this.getElement().style.transform="translate3d("+this.style.translateX+"px,"+this.style.translateY+"px, 0)"},a.prototype.load=function(){this.existsOnPage=!0,this._updateStyles(),this.pig.container.appendChild(this.getElement()),setTimeout(function(){this.existsOnPage&&(this.fullImage||(this.fullImage=new Image,this.fullImage.src=this.pig.settings.urlForSize(this.filename,this.pig.settings.getImageSize(this.pig.lastScrollElementWidth)),this.fullImage.onload=function(){this.fullImage&&(this.fullImage.className+=" "+this.classNames.loaded)}.bind(this),this.fullImage.addEventListener("click",function(t){this.pig.settings.click(t,this.filename,this.submissionId)}.bind(this)),this.getElement().appendChild(this.fullImage)))}.bind(this),100)},a.prototype.hide=function(){this.getElement()&&(this.thumbnail&&(this.thumbnail.src="",this.getElement().removeChild(this.thumbnail),delete this.thumbnail),this.fullImage&&(this.fullImage.src="",this.getElement().removeChild(this.fullImage),delete this.fullImage)),this.existsOnPage&&this.pig.container.removeChild(this.getElement()),this.existsOnPage=!1},a.prototype.getElement=function(){return this.element||(this.element=document.createElement(this.pig.settings.figureTagName),this.element.className=this.classNames.figure,this._updateStyles()),this.element},a.prototype._updateStyles=function(){this.getElement().style.transition=this.style.transition,this.getElement().style.width=this.style.width+"px",this.getElement().style.height=this.style.height+"px",this.getElement().style.transform="translate3d("+this.style.translateX+"px,"+this.style.translateY+"px, 0)"},"function"==typeof define&&define.amd?define(s):"undefined"!=typeof module&&module.exports?module.exports=s:t.Pig=s}(this);